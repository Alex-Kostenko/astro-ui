---
import "@style/cases.css";
import Layout from "@layouts/Layout.astro";
import { type Languages, languages } from "@i18n/index";
import { cubeNear } from "src/assets";
import { IntroSection } from "@components/Sections";
import type { GetStaticPaths } from "astro";
import projectService from "@service/project.service";
import ProjectList from "@components/ProjectCard/ProjectList.astro";
import { Container } from "@components/Container";
import TabsSection from "@components/Sections/Cases/TabsSection.astro";
import type { IProjectDomain } from "@interfaces/project.domain";
import { Pagination } from "@components/Pagination";
import ContactUsSection from "@components/Form/ContactUsSection.astro";

export const getStaticPaths = (async ({ paginate }) => {
  const projectDomain: IProjectDomain[] = [
    ...(await projectService.getDomains()).data,
    {
      slug: "all",
      documentId: "",
      createdAt: "",
      id: 0,
      locale: "en",
      name: "all",
      publishedAt: "",
      updatedAt: "",
    },
  ];

  const requestProjects = [...Object.keys(languages), ""].flatMap((lang) =>
    projectDomain.map((domain) =>
      projectService
        .get({
          pagination: { limit: "max" },
          locale: lang as Languages,
          filter:
            domain.id !== 0
              ? [
                  {
                    fields: ["project_domains", "documentId"],
                    value: domain.documentId,
                  },
                ]
              : [],
        })
        .then((response) => ({ lang, case: domain, response })),
    ),
  );

  const responses = await Promise.all(requestProjects);

  return responses.flatMap((v) => {
    return paginate(v.response.data, {
      params: { lang: v.lang, case: v.case.slug },
      props: { meta: v.response.meta, slug: v.case.slug },
      pageSize: 6,
    });
  });
}) satisfies GetStaticPaths;

const { page, meta, slug } = Astro.props;
---

<Layout title="UniCode Cases">
  <link
    slot="head"
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"
  />
  <main class="flex flex-col gap-y-[120px]">
    <div class="h-[144px] lg:h-[168px] bg-black bg-opacity-45">
      <video
        autoplay
        muted
        loop
        class="relative -z-10 bg-black bg-opacity-45 h-full w-full object-cover"
      >
        <source src={cubeNear} type="video/mp4" />
      </video>
    </div>
    <IntroSection />

    <TabsSection domain={slug} />

    <Container id="projects">
      <ProjectList projects={page.data} />
      <Pagination paginate={page} href={`/cases/${slug}/`} toBlock="cases" />
    </Container>

    <ContactUsSection
      text={[
        { text: "your idea", alight: "right", variant: "contained" },
        { text: "& our mission", alight: "none", variant: "contained" },
        { text: "to make it real", alight: "left", variant: "outlined" },
      ]}
    />
  </main>
</Layout>
